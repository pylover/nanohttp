
from os.path import dirname, abspath
from nanohttp import Controller, html, context, Static, HttpFound, settings, action


logo = b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00\x10\x00\x00\x00\x10' \
       b'\x08\x06\x00\x00\x00\x1f\xf3\xffa\x00\x00\x00\x19tEXtSoftware\x00' \
       b'Adobe ImageReadyq\xc9e<\x00\x00\x02\xeeIDATx\xdal\x93KL\x13A\x1c' \
       b'\xc6\xbf}u\xb7\xed\xf6\x01X \x16(PA=\x18\x03\xd1h\xc2\x81\x18\x13=' \
       b'\x1bC8\xa8\xc4\x03*\x1eL\x0c\x17\xa3\'\x0e\xde\xd4x\xd0\xc4\x03x' \
       b'\xf1\xe0#A\x0f\x1a\x89\x89^\xf4bHT\x88\xe0\x0b\x84\xf0XkKwi\xe9' \
       b'\xeevw\xdb\xed\x8e[T\x02)3\x99\xcc\xcc?\xf3\xfd\xe6?3\xdfP\x84\x10' \
       b'\x94K\x7f\xff\xc4zO\xd3%8\x0e@Q@  \x9e\xf6z\x85C\xd9l\xee\x9eeY_' \
       b'\xcb1\x80EY22\xd2\x81\xbf\xb3M\xa5\x0cc\x18f\xbf\xc7\xc36\x96J' \
       b'\xf6B$\x12\x19\xd1u\x8d\xaf\xaa\n\xb7g2\xd9A\x17 \x9a\xa6=\xee' \
       b'\xe274\x9b\x00\x04\x82\xc0\x1dmm\x8d\xbd1\x0c\xa3\xbcKZ\x96\x15' \
       b'\xdem\x88\xc7[\x8e\xd5\xd6F\xa6\x05A@2\xb9\xd2\xaf\xaa\xda\xfd' \
       b'\xff*zc@\x13\xf0<W\xb3\xba\xba\x8a\xd9\xd99WmFt\xd5\x02\x1c?\xac' \
       b'\x02\x8d\xc5\xc5\x05H\x92\x04\xaf\x97\xeft\x83\xdbg\xa0i\xfa7A\xe0' \
       b'\xe7\x1c\x12\x887\x84G\xd1w\xe9)\n&\x8f\x07\xa3\xe7\xb1\x96kC0H\x9b' \
       b'\xb9\x9c\xfa\x94\xa2\xe8J\x80\x9b\xde\x99\xe6\xe6\xd8}\xc3(\x14\xf6' \
       b'\xc45\\\x1e\x18\x86G[tW\x98\xb8x\xe2\x17n\xe4\x9f\x81f\x03o\x15E' \
       b'\xfeHQ\x04\x15G\x10E\xb1;\x95Jq?f\x16\xfc\xab\xca\x0c<\x90\x81' \
       b'\xdf&\xa0\x005\xf9Y8E\t\xaaf\x1eojj\xfc\xc9q\xdc\x81\n\x80\x9b\xfe' \
       b'\xa8\xcf\xe7\x87\xcf\xc7\xa2Hv!\xb1\xd4\x06x\xb1~\xe1\xef\xe6\xcf!' \
       b'\xa1D\x91\xcd\xc8\xc8\xe7\xf5\x1d\xe1p\xb8\xaf\xe2\x08\xa6i\xbeJ' \
       b'\xa7\xe5\xc3\xc1\x80\xff\xac(\x86\x07\xae\xdd\xb9\x8e\xce\xf6I(' \
       b'\x990$\xb5\x0bm\xf1\x10\xb1\xed\x10E\xd3L\xda]7\x0c\xc4\xb6\x02' \
       b'\x18\xb7Z\x865\x1e\x10\xc5#\x96\xa5\xa1\x04\x11?\xa4\x930m\x1d\xc4Y' \
       b'\x03\xb1\x83D\x95\xf3]\x85\xa2\xf5\x9dv\xd8LE\x069>\x03\xda\xa1ai' \
       b'\xc1\xa9\xa6h#\xf8z/\xa4\x96)\xb9.\xddR\x1d*D\xad\x84#\xdd\x1cky' \
       b'\xf8>\xeb\x97\xe1\x83\x1fwq{+\xe0\xd1\xa1[\x80M!\xaa\xb6\x8e\xb5g' \
       b'\xf7w\xd0\x02\x97\xfb\x1c{>Tm\xec}\xb2S\xa8-.\xef\xf9\xd0k\xb1\xea' \
       b'\'\xd6\xa6^/\xa5\xe7\xae\xe2\x9f\x196\x00\xc4)QM\xcd\xe1\x11\xc6' \
       b'\x93:6\x87\xb1B\xde\xb2\'a\xb0\xe2\xcf\xc6\xf1\x9e\x04C\xf5\xa83' \
       b'\xb6\xcf_\x13D,\xca\x18\xc9\xec\x1a\xa94\x92\xfb\xb6A\xd1#\xf0,' \
       b'\xdb\xf0e"\x01\xcavZ\xebw\x06\xc1x\x039\x81*L\xd5\xb5\xf9\xbd\x84*' \
       b'\xbe\x99\xf9\xb6<\x04\x90m\x00\x1cE\xa6\xbf&O\xd5\xd7\x85^\xec;' \
       b'\xd8p\xc1)\x91\xd0\xbc\x94\xb9R,\xd9\xdd\xb2n\xef\xb6\x93J/,\xddq=' \
       b'\x8f\xf5Vi\xe5\xf2\x8cq?\x8b\xfaxE\xc9\xbft\xed\xea+\xd9\xc5\x14' \
       b'\xcd\x13\xd7y\xfc \xc4\x80\x07\x1cm"\xafo\x91\xfc\x11`\x00\x9d\'Q' \
       b'\x1d\x85\x06\xec\xd8\x00\x00\x00\x00IEND\xaeB`\x82'


class Root(Controller):
    static = Static(abspath(dirname(__file__)))

    @html
    def index(self):
        yield '<html><head><title>nanohttp demo</title></head><body>'
        yield '<h1>nanohttp demo page</h1>'
        yield '<h2>debug flag is: %s</h2>' % settings.debug
        yield '<img src="/static/cat.jpg" />'
        yield '<ul>'
        yield from (
            '<li><b>%s:</b> %s</li>' % i for i in context.environ.items()
        )
        yield '</ul>'
        yield '</body></html>'

    @html('post', 'put')
    def contact(self):
        yield '<h1>Thanks: %s</h1>' % context.form['name'] \
            if context.form else 'Please send a name.'

    @html
    def google(self):
        raise HttpFound('http://google.com')

    @html
    def error(self):
        raise Exception()

    @action(content_type='images/png', encoding=None)
    def logo(self):
        yield logo


if __name__ == '__main__':
    from nanohttp import quickstart
    quickstart(Root(), config='<sfsfsd>')
